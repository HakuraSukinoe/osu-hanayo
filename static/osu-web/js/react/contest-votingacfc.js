(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{14:function(t,e,s){t.exports=s("KWcN")},KWcN:function(t,e,s){"use strict";s.r(e);var o=s("cDcd"),n=s("NzAu"),r=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty;o.createElement;var c,a=function(t){function e(t){this.isSelected=r(this.isSelected,this),this.handleClick=r(this.handleClick,this),this.sendVote=r(this.sendVote,this),e.__super__.constructor.call(this,t)}return function(t,e){for(var s in e)i.call(e,s)&&(t[s]=e[s]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,t),e.prototype.sendVote=function(){var t;return t={method:"PUT",dataType:"json"},$.ajax(laroute.route("contest-entries.vote",{contest_entry:this.props.entry.id}),t).done((function(t){return $.publish("contest:vote:done",{response:t})})).fail(osu.ajaxError).always((function(){return $.publish("contest:vote:end")}))},e.prototype.handleClick=function(t){if(t.preventDefault(),this.isSelected()||this.props.selected.length<this.props.contest.max_votes)return null==currentUser.id?userLogin.show(t.target):this.props.waitingForResponse?void 0:($.publish("contest:vote:click",{contest_id:this.props.contest.id,entry_id:this.props.entry.id}),this.sendVote())},e.prototype.isSelected=function(){return _.includes(this.props.selected,this.props.entry.id)},e.prototype.render=function(){var t,e,s,o,r,i,c,a,p,l;return l=moment(this.props.contest.voting_ends_at).diff()<=0,i=this.isSelected(),r=this.props.waitingForResponse,s=this.props.selected.length<this.props.contest.max_votes,c=i||!l&&s,t=["js-contest-vote-button","contest__voting-star","contest__voting-star--float-right",this.props.theme?"contest__voting-star--"+this.props.theme:void 0],e=n.div,a={"data-button-id":this.props.buttonId,"data-contest-vote-meta":JSON.stringify({hasVote:s,isSelected:i,isLoading:r,votingOver:l})},o=null,c?(p=i?[this.props.theme?"contest__voting-star--selected-"+this.props.theme:"contest__voting-star--selected"]:[],l?(a.className=t.concat(p).join(" "),o=Object(n.i)({className:"fas fa-fw fa-star"})):r&&!i?(a.className=t.join(" "),o=Object(n.i)({className:"fas fa-fw fa-sync contest__voting-star--spin"})):(e=n.a,a.className=t.concat(p).join(" "),a.href="#",a.onClick=this.handleClick,o=Object(n.i)({className:"fas fa-fw fa-star"}))):a.className=t.join(" "),e(a,o)},e}(o.Component),p={}.hasOwnProperty;c=o.createElement;var l,u=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var s in e)p.call(e,s)&&(t[s]=e[s]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,t),e.prototype.render=function(){var t,e,s,o,r,i,p,l,u,h,d;return d=moment(this.props.contest.voting_ends_at).diff()<=0,r=_.includes(this.props.selected,this.props.entry.id),l=this.props.contest.show_votes,p=this.props.contest.shape,t=(s="contest-"+this.props.contest.id)+":"+this.props.displayIndex,o=(this.props.selected.length>=this.props.contest.max_votes||d)&&!r,l&&(h=_.round(this.props.entry.results.votes/this.props.totalVotes*100,2),u=(i=this.props.displayIndex+1)<=3),e=["contest-art-entry",l?"contest-art-entry--result":void 0,l&&u?"contest-art-entry--placed contest-art-entry--placed-"+i:void 0,l&&!u?"contest-art-entry--smaller":void 0,p?"contest-art-entry--"+p:void 0],Object(n.div)({style:{backgroundImage:osu.urlPresence(this.props.entry.artMeta.thumb)},className:_.compact(e).join(" ")},Object(n.a)({className:_.compact(["js-gallery contest-art-entry__thumbnail",r?"contest-art-entry--selected":void 0]).join(" "),href:this.props.entry.preview,"data-width":this.props.entry.artMeta.width,"data-height":this.props.entry.artMeta.height,"data-gallery-id":s,"data-index":this.props.displayIndex,"data-button-id":t}),Object(n.div)({className:_(["contest__vote-link-banner",r?"contest__vote-link-banner--selected":void 0,l&&i>2?"contest__vote-link-banner--smaller":void 0,o?"hidden":void 0]).compact().join(" ")},c(a,{key:this.props.entry.id,entry:this.props.entry,waitingForResponse:this.props.waitingForResponse,voteCount:this.props.selected.length,contest:this.props.contest,selected:this.props.selected,theme:l&&i>2?"art-smaller":"art",buttonId:t})),l?Object(n.div)({className:"contest-art-entry__result"},Object(n.div)({className:"contest-art-entry__result-ranking"},Object(n.div)({className:"contest-art-entry__result-place"},u?Object(n.i)({className:"fas fa-fw fa-trophy contest-art-entry__trophy--"+i}):void 0,Object(n.span)({},"#"+i)),this.props.entry.results.user_id?Object(n.a)({className:"contest-art-entry__entrant js-usercard","data-user-id":this.props.entry.results.user_id,href:laroute.route("users.show",{user:this.props.entry.results.user_id})},this.props.entry.results.username):Object(n.span)({className:"contest-art-entry__entrant"},this.props.entry.results.actual_name)),Object(n.div)({className:"contest-art-entry__result-pane"},Object(n.span)({className:"contest-art-entry__result-votes"},osu.transChoice("contest.vote.count",this.props.entry.results.votes)),isNaN(h)?void 0:Object(n.span)({className:"contest-art-entry__result-votes contest-art-entry__result-votes--percentage"}," ("+osu.formatNumber(h)+"%)"))):void 0)},e}(o.Component),h=function(t,e){return function(){return t.apply(e,arguments)}},d={}.hasOwnProperty,v=function(t){function e(t){var s,o,n;this.handleUpdate=h(this.handleUpdate,this),this.handleVoteClick=h(this.handleVoteClick,this),e.__super__.constructor.call(this,t),this.state={waitingForResponse:!1,contest:this.props.contest,selected:this.props.selected,options:{showPreview:null!=(s=this.props.options.showPreview)&&s,showLink:null!=(o=this.props.options.showLink)&&o,linkIcon:null!=(n=this.props.options.linkIcon)&&n}}}return function(t,e){for(var s in e)d.call(e,s)&&(t[s]=e[s]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,React.Component),e.prototype.handleVoteClick=function(t,e){var s,o,n,r;if(o=e.contest_id,n=e.entry_id,s=e.callback,o===this.state.contest.id)return r=_.clone(this.state.selected),_.includes(r,n)?_.pull(r,n):r.push(n),this.setState({selected:r,waitingForResponse:!0},s)},e.prototype.handleUpdate=function(t,e){var s,o;if(o=e.response,s=e.callback,o.contest.id===this.state.contest.id)return this.setState({contest:o.contest,selected:o.userVotes,waitingForResponse:!1},s)},e.prototype.componentDidMount=function(){return $.subscribe("contest:vote:click.contest",this.handleVoteClick),$.subscribe("contest:vote:done.contest",this.handleUpdate)},e.prototype.componentWillUnmount=function(){return $.unsubscribe(".contest")},e}();l=osu.classWithModifiers("contest__voting-star",["smaller"]);var y,m=function(t){var e,s,o,r;return r=t.voteCount,o=t.maxVotes,Object(n.div)(null,function(){var t,i,c;for(c=[],s=t=0,i=o;0<=i?t<i:t>i;s=0<=i?++t:--t)e=l,s<r&&(e+=" contest__voting-star--selected"),c.push(Object(n.div)({key:"vote-"+s,className:e},Object(n.span)({className:"fas fa-fw fa-star"})));return c}())},f={}.hasOwnProperty;y=o.createElement;var b,w=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var s in e)f.call(e,s)&&(t[s]=e[s]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,t),e.prototype.render=function(){var t,e,s,o;return this.state.contest.entries.length>0?(this.state.contest.show_votes&&(s=_.sumBy(this.state.contest.entries,(function(t){return t.results.votes}))),t=this.state.contest.entries.map((o=this,function(t,e){return y(u,{key:e,displayIndex:e,entry:t,waitingForResponse:o.state.waitingForResponse,options:o.state.options,contest:o.state.contest,selected:o.state.selected,totalVotes:o.state.contest.show_votes?s:void 0})})),this.state.contest.show_votes&&(e=_.partition(t,(function(t){return t.props.displayIndex<3}))),Object(n.div)({className:"contest__art-list"},Object(n.div)({className:"contest__vote-summary--art"},Object(n.span)({className:"contest__vote-summary-text contest__vote-summary-text--art"},"votes"),y(m,{voteCount:this.state.selected.length,maxVotes:this.state.contest.max_votes})),this.state.contest.show_votes?Object(n.div)({},Object(n.div)({className:"contest-art-list contest-art-list--top3"},e[0]),Object(n.div)({className:"contest-art-list"},e[1])):Object(n.div)({className:"contest-art-list"},t))):null},e}(v),g=s("GLyB"),j={}.hasOwnProperty;b=o.createElement;var N,O=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var s in e)j.call(e,s)&&(t[s]=e[s]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,t),e.prototype.render=function(){var t,e,s;return this.props.contest.show_votes&&(s=_.round(this.props.entry.results.votes/this.props.totalVotes*100,2),t=_.round(this.props.entry.results.votes/this.props.winnerVotes*100,2)),e=_.includes(this.props.selected,this.props.entry.id),Object(n.div)({className:"contest-voting-list__row"+(e&&!this.props.contest.show_votes?" contest-voting-list__row--selected":"")},this.props.contest.show_votes?Object(n.div)({className:"contest-voting-list__rank"},this.props.rank<4?Object(n.span)({className:"contest-voting-list__trophy contest-voting-list__trophy--"+this.props.rank},Object(n.i)({className:"fas fa-fw fa-trophy"})):"#"+this.props.rank):void 0,this.props.options.showPreview?Object(n.div)({className:"contest-voting-list__preview"},b(g.a,{track:this.props.entry})):void 0,this.props.options.showLink&&this.props.entry.preview?this.props.contest.best_of?Object(n.a)({href:laroute.route("beatmapsets.show",{beatmapset:this.props.entry.preview}),className:"contest-voting-list__icon contest-voting-list__icon--best-of",style:{background:"url(https://b.ppy.sh/thumb/"+this.props.entry.preview+".jpg)"}},Object(n.span)({className:"tracklist__link tracklist__link--shadowed"},Object(n.i)({className:"fal fa-fw fa-lg fa-"+this.props.contest.link_icon}))):Object(n.div)({className:"contest-voting-list__icon contest-voting-list__icon--bg"},Object(n.a)({className:"tracklist__link",href:this.props.entry.preview},Object(n.i)({className:"fas fa-fw fa-lg fa-download"}))):void 0,this.props.contest.show_votes?Object(n.div)({className:"contest-voting-list__title contest-voting-list__title--show-votes"},Object(n.div)({className:"contest-voting-list__votes-bar",style:{width:t+"%"}}),Object(n.div)({className:"u-ellipsis-overflow"},this.props.entry.title),Object(n.a)({className:"contest-voting-list__entrant js-usercard","data-user-id":this.props.entry.results.user_id,href:laroute.route("users.show",{user:this.props.entry.results.user_id})},this.props.entry.results.username)):Object(n.div)({className:"contest-voting-list__title u-ellipsis-overflow"},this.props.entry.title),Object(n.div)({className:"contest__voting-star"+(this.props.contest.show_votes?" contest__voting-star--dark-bg":"")},b(a,{key:this.props.entry.id,entry:this.props.entry,waitingForResponse:this.props.waitingForResponse,selected:this.props.selected,contest:this.props.contest})),this.props.contest.show_votes?this.props.contest.best_of?Object(n.div)({className:"contest__vote-count contest__vote-count--no-percentages"},osu.transChoice("contest.vote.points",this.props.entry.results.votes)):Object(n.div)({className:"contest__vote-count"},osu.transChoice("contest.vote.count",this.props.entry.results.votes),isFinite(s)?" ("+osu.formatNumber(s)+"%)":void 0):void 0)},e}(o.Component),k={}.hasOwnProperty;N=o.createElement;var x,C=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return function(t,e){for(var s in e)k.call(e,s)&&(t[s]=e[s]);function o(){this.constructor=t}o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype}(e,t),e.prototype.render=function(){var t,e,s;return this.state.contest.best_of&&0===this.state.contest.entries.length?Object(n.div)({className:"contest__voting-notice"},null!=currentUser.id?osu.trans("contest.voting.best_of.none_played"):osu.trans("contest.voting.login_required")):this.state.contest.entries.length>0?(this.state.contest.show_votes&&(e=_.sumBy(this.state.contest.entries,(function(t){return t.results.votes}))),t=this.state.contest.entries.map((s=this,function(t,o){return N(O,{key:t.id,rank:o+1,entry:t,waitingForResponse:s.state.waitingForResponse,options:s.state.options,contest:s.state.contest,selected:s.state.selected,winnerVotes:s.state.contest.show_votes?_.maxBy(s.state.contest.entries,(function(t){return t.results.votes})).results.votes:void 0,totalVotes:s.state.contest.show_votes?e:void 0})})),Object(n.div)({className:"contest-voting-list__table"},Object(n.div)({className:"contest-voting-list__header"},this.state.options.showPreview?Object(n.div)({className:"contest-voting-list__icon"}):void 0,this.state.options.showLink?Object(n.div)({className:"contest-voting-list__icon"}):void 0,Object(n.div)({className:"contest-voting-list__header-wrapper"},Object(n.div)({className:"contest-voting-list__header-title"},osu.trans("contest.entry._")),Object(n.div)({className:"contest-voting-list__header-votesummary"},Object(n.div)({className:"contest__vote-summary-text"},osu.trans("contest.vote.list")),N(m,{voteCount:this.state.selected.length,maxVotes:this.state.contest.max_votes})))),Object(n.div)({},t))):null},e}(v);x=function(t){var e;return{contest:(e=osu.parseJson(t.dataset.src)).contest,selected:e.userVotes,options:{showPreview:"music"===e.contest.type,showLink:"beatmap"===e.contest.type&&_.some(e.contest.entries,"preview")}}},reactTurbolinks.register("contestArtList",w,x),reactTurbolinks.register("contestList",C,x)},NzAu:function(t,e){t.exports=ReactDOMFactories},cDcd:function(t,e){t.exports=React}},[[14,0]]]);
//# sourceMappingURL=contest-voting.js.map